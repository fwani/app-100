# 로컬 LLM 자동 문서 생성 앱 – 실행 계획 (웹→Flutter)

## 0. 목표/스코프

* **목표:** 기사/블로그/소설 초안 자동 생성 → 대화형 편집 → 검색결과 결합 딥리서치 → 롱폼(아웃라인→챕터)까지 단계적 구현.
* **제약:** 1인 개발, 로컬 LLM 우선, 무/저비용. 품질보다 **출시 속도** 우선, 이후 지속 개선.
* **타깃:** 블로거/개발자(초안 작성·리라이팅), 학생(리포트 개요), 개인 창작자(단편/장편 실험).

---

## 1. 아키텍처 개요

* **Frontend (웹→모바일):** Flutter Web(최초) → 동일 코드베이스로 iOS/Android 확장.
* **Backend:** Python FastAPI (REST).
* **LLM 실행:** 로컬(우선) – `llama.cpp`/`Ollama` + `llama-cpp-python` 바인딩.
* **RAG/검색:** Chroma/FAISS(벡터DB) + RSS/웹 크롤링(trafilatura/newspaper3k) + 간이 캐시(SQLite).
* **스토리지:** SQLite(문서/세션/프롬프트 템플릿/메타데이터), 파일시스템(마크다운/리비전).
* **배포:** 로컬 개발 → Docker(선택) → 개인 서버/NAS(선택). 모바일은 백엔드 공용.

```
Flutter(Web/App)  ── REST ── FastAPI ── LLM(runtime: llama.cpp/Ollama)
                                   ├─ RAG(Vector DB: Chroma/FAISS)
                                   ├─ Crawler(RSS+trafilatura)
                                   └─ SQLite(Storage)
```

---

## 2. 모델/런타임 선택(초기)

* **기본:** Mistral 7B Instruct / Llama 2 7B Chat (Q4\_K\_M 양자화) – 한국어 혼용 가능 모델 우선 테스트.
* **대안(ko 중심):** polyglot-ko 5.8B, Ko-이니셜 계열 등 경량 ko 모델 A/B 테스트.
* **런타임:**

    * 노트북/PC: `Ollama`로 손쉬운 모델 교체 및 메모리 관리.
    * Python 파이프라인: `llama-cpp-python`으로 세밀 제어(토큰/샘플링/스트리밍).

---

## 3. 기능 로드맵 (마일스톤)

### M0 (주 0) 환경/뼈대

* FastAPI 스캐폴드, Flutter Web 프로젝트 생성, 공통 타입/DTO, 헬스체크/로그.
* LLM 런타임 1종 연결(스트리밍 출력), 기본 프롬프트 템플릿 로딩(파일/DB).

### M1 (주 1) **싱글턴 초안 생성 MVP**

* 카테고리별 템플릿(기사/블로그/소설) + 파라미터(톤/길이/목차).
* 출력: Markdown/Plain, 글자 수/단락 수 제어, 단락 헤더 자동 생성.
* 저장: 문서/세션/프롬프트 메타(SQLite). 내보내기: `.md`/`.txt`.

### M2 (주 2) **멀티턴 대화형 편집**

* 문서 상태머신: Draft → Revised(n). 변경 이력(diff) 저장.
* 편집 명령 세트: `축약/확장/톤변경/스타일맞춤/구조재배열/예시추가/메타정보추가`.
* 부분 편집: 선택 범위(단락/헤더) 타깃 수정, 변경분만 재생성.

### M3 (주 3–4) **딥리서치(RAG v1)**

* RSS+간이검색 → 문서 수집 → trafilatura 정제 → 임베딩 → Chroma 인덱싱.
* 생성 시 근거 스니펫 인용(각주/링크), 근거 누락 경고.
* 캐싱/중복제거, 토픽별 인덱스(예: AI/모바일/경제).

### M4 (주 5–6) **롱폼 v1(아웃라인→챕터)**

* 3단계 파이프라인: `아웃라인` → `챕터 생성` → `일관성 검토/수정`.
* 스토리 바이블(인물/설정/타임라인) 자동 추출·요약·참조.
* 컨텍스트 관리: 슬라이딩 윈도우 + 요약 메모리 + 장면 키워드.

### M5 (주 7–8) 품질/UX 고도화

* 프롬프트 라이브러리/프리셋, 스니펫 패널(자주 쓰는 문구).
* 품질 지표(가독성, 중복률, 근거율) 자동 점검 리포트.

---

## 4. 세부 구현 계획

### 4.1 데이터/템플릿

* **템플릿 필드:** {주제, 대상독자, 톤, 길이, 구조(헤더 리스트), 키워드, 금지어}
* **few-shot 예시:** 카테고리별 2–3개 우수 예시를 시스템 프롬프트에 포함.
* **규칙:** 금지 표현/스타일 가이드(예: 과도한 감탄사 금지, 단락 길이 제한).

### 4.2 프롬프트 설계(초안)

* **기사:** 헤드라인→리드→바디(3–5단락)→요약(불릿) 구조, 중립 톤, 사실/근거 분리.
* **블로그:** Hook→문제정의→해결/팁→예시→CTA.
* **소설:** 로그라인→등장인물→배경→갈등→전개→결말 후보 2안.

### 4.3 멀티턴 편집 워크플로우

* 입력: (현재문서, 사용자지시, 선택영역, 제약)
* 출력: (수정문서, 변경요약, 근거/결정사유)
* 프롬프트 키워드 예: `"이 단락만 20% 축약", "기술어를 줄이고 쉽게", "3개 불릿으로 정리"`.
* **Diff 계산:** 문단 단위 LCS → 변경 하이라이트 → 되돌리기.

### 4.4 딥리서치(RAG v1)

* 수집: RSS/키워드 검색 → HTML → trafilatura 정제 → 메타(title, date, src).
* 임베딩: `sentence-transformers` 계열(ko 지원) → Chroma 저장.
* 검색: Top-k + MMR, 최신순 가중.
* 주입: 근거 스니펫 + 출처 링크를 모델 컨텍스트에 포함.

### 4.5 롱폼 파이프라인

1. **아웃라인 생성:** 장/씬 단위 목차 + 장면 목표 + 갈등/단서.
2. **챕터 생성:** 직전까지 요약(≤N토큰) + 스토리 바이블 참조.
3. **일관성 검사:** 인물/설정 체크리스트 자동 검토 → 수정 프롬프트.

---

## 5. 기술 스택 & 패키지

* **Backend:** FastAPI, pydantic, uvicorn, loguru, sqlite3/SQLModel.
* **LLM:** llama-cpp-python 또는 Ollama; 토큰화: sentencepiece.
* **RAG:** chromadb 또는 faiss, sentence-transformers(ko 임베딩), trafilatura/newspaper3k, feedparser.
* **Frontend:** Flutter(Web/App), Riverpod/Bloc 상태관리, Markdown 렌더러, 코드블록 하이라이트.
* **테스트:** pytest, Playwright(웹), Flutter test.

---

## 6. 저장 구조/레포 구조

```
repo/
  backend/
    app.py (FastAPI)
    routers/
      generate.py  (싱글턴)
      edit.py      (멀티턴)
      search.py    (딥리서치)
      longform.py  (롱폼)
    core/
      llm.py       (런타임 어댑터)
      rag.py       (임베딩/검색)
      prompts/
        article.md, blog.md, novel.md
    db/
      models.py, migrations/
  frontend/
    flutter_app/
      lib/
        screens/, widgets/, services/api_client.dart
  docs/
    roadmap.md, prompts.md
```

---

## 7. 일정(8주 러프 플랜)

* **1주차:** M0–M1 — 런타임 연결, 싱글턴 MVP, 템플릿 3종, 저장/불러오기.
* **2주차:** M2 — 대화형 편집, 부분 편집, diff/undo, 이력 UI.
* **3–4주차:** M3 — RAG v1(수집→임베딩→검색→인용), 캐시/중복제거.
* **5–6주차:** M4 — 롱폼 v1(아웃라인→챕터), 바이블 자동화, 일관성 체크.
* **7–8주차:** M5 — 품질지표, UX 개선, 성능/프롬프트 튜닝, 크로스플랫폼 빌드.

---

## 8. 품질/메트릭

* **가독성 점수(문장 길이/수식어 비율)**, **중복률**, **헤더-본문 일치율**, **출처 인용률(RAG)**.
* **편집 효율:** 1, 2, 3회 수정 후 만족도, 수정량(토큰) 대비 품질 향상.
* **지연시간:** 초안 N자 생성 ≤ X초, 부분 편집 ≤ Y초.

---

## 9. 리스크/대응

* **모델 한국어 품질 편차:** 프롬프트 few-shot/사전예시 강화, ko 임베딩 채택.
* **롱폼 맥락 손실:** 요약 메모리/슬라이딩윈도우/바이블 참조 강제.
* **크롤링 차단/품질:** RSS 우선, 로봇규약 준수, 캐시+화이트리스트 도메인.
* **성능:** Q4 양자화+GPU가속(가능시), 스트리밍 UI, 문단 단위 생성.

---

## 10. 오늘 시작 체크리스트

* [ ] FastAPI 스켈레톤 + `/healthz` + `/generate` 엔드포인트
* [ ] Ollama 또는 llama.cpp 설치, 7B Instruct 모델 1종 로드
* [ ] 프롬프트 템플릿(article/blog/novel) 초안 작성
* [ ] Flutter Web 프로젝트 생성 + 초안 요청/응답 화면
* [ ] SQLite 테이블: documents, revisions, templates, sources

---

## 11. 백로그(우선순위 낮음)

* 문체 변환(신문체/에세이/튜토리얼), SEO 키워드 삽입, 이미지 캡션 생성
* 다국어 변환, 문장 교정기(맞춤법/띄어쓰기), 음성 입력/읽기 지원
* 플러그인 구조(템플릿/에디터 명령 커스텀), 팀 협업 기능(공동 편집)
